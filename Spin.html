<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéØ Lucky Spin Pro</title>
<style>
body {
    font-family: sans-serif;
    background: #0f172a;
    color: #fff;
    text-align: center;
    margin:0;
    padding:10px;
}
#loginBox, #gameBox {
    display: block; /* ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø */
    margin-top: 20px;
}
#gameBox { display: none; } /* ‡¶ó‡ßá‡¶Æ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã ‡¶•‡¶æ‡¶ï‡¶¨‡ßá */
input {
    padding: 10px;
    border-radius: 6px;
    border: none;
    margin: 5px;
    width: 200px;
    text-align: center;
    font-size: 16px;
}
button {
    padding: 10px 20px;
    margin: 5px;
    border-radius: 6px;
    cursor: pointer;
    background: #1e3a8a;
    color: #fff;
    border: none;
    font-size: 16px;
}
#poster {
    width: 90%;
    max-width: 300px;
    margin: 10px auto;
    display: block;
    border-radius: 10px;
}
#wheelContainer {
    position: relative;
    width: 300px;
    height: 300px;
    margin: 20px auto;
}
#wheel {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: url('https://raw.githubusercontent.com/hendrisarkar483-wq/coin-play/refs/heads/main/wheel.png') no-repeat center/cover;
    border: 5px solid #fff;
    transition: transform 1s cubic-bezier(0.25,1,0.5,1);
}
#pointer {
    position: absolute;
    top: 10%;
    left: 50%;
    transform: translateX(-50%) translateY(-100%);
    font-size: 40px;
    color: red;
}
#coinsView, #history {
    margin-top: 10px;
    font-size: 18px;
}
.coinButtons {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
}
.coinButtons button {
    width: 40px;
    height: 40px;
    padding: 0;
    font-size: 24px;
    line-height: 40px;
    border-radius: 50%;
}
#history {
    max-height: 150px;
    overflow-y: auto;
    margin-top: 10px;
    text-align: left;
    padding: 10px;
    border: 1px solid #555;
    border-radius: 6px;
}
</style>
</head>
<body>
<h1>üéØ Lucky Spin Pro</h1>

<!-- ===== Login ===== -->
<div id="loginBox">
  <h2>‡¶≤‡¶ó‡¶á‡¶®</h2>
  <img id="poster" src="https://raw.githubusercontent.com/hendrisarkar483-wq/coin-play/refs/heads/main/play%20%26%20coins.png" alt="Poster">
  <input type="text" id="mobile" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Ç"><br>
  <input type="password" id="pin" placeholder="PIN ‡¶ï‡ßã‡¶°"><br>
  <button id="loginBtn">‡¶≤‡¶ó‡¶á‡¶®</button>
  <div id="loginMsg"></div>
</div>

<!-- ===== Game Box ===== -->
<div id="gameBox">
  <h2>Spin Game</h2>
  <div id="coinsView">Coins: 0</div>

  <div class="coinButtons">
    <button id="decCoin">-</button>
    <input type="number" id="betAmount" value="1" min="1" max="20000">
    <button id="incCoin">+</button>
  </div>

  <div id="wheelContainer">
    <div id="wheel"></div>
    <div id="pointer">üîª</div>
  </div>

  <button id="spinBtn">üéØ Spin</button>
  <div id="spinMsg"></div>

  <div id="history"></div>

  <audio id="spinSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
// ================= Firebase =================
const firebaseConfig = {
  apiKey: "AIzaSyC33MnqbprRYlgdKRbCv0749ZOgyMqufcw",
  authDomain: "coinplay-9e67f.firebaseapp.com",
  databaseURL: "https://coinplay-9e67f-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "coinplay-9e67f",
  storageBucket: "coinplay-9e67f.appspot.com",
  messagingSenderId: "1096066059726",
  appId: "1:1096066059726:web:c1f4320b42df37dd626f9f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ================= State =================
let userPhone = null;
let userCoins = 0;
let userLevel = 1;
let history = [];

// ================= UI Elements =================
const loginBox = document.getElementById("loginBox");
const gameBox = document.getElementById("gameBox");
const coinsView = document.getElementById("coinsView");
const betInput = document.getElementById("betAmount");
const spinBtn = document.getElementById("spinBtn");
const wheel = document.getElementById("wheel");
const spinSound = document.getElementById("spinSound");
const historyDiv = document.getElementById("history");

// ================= Login =================
document.getElementById("loginBtn").addEventListener("click", async ()=>{
  const mobile = document.getElementById("mobile").value.trim();
  const pin = document.getElementById("pin").value.trim();
  if(!mobile || !pin){ document.getElementById("loginMsg").innerText="‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®"; return; }

  const snap = await db.ref("users/"+mobile).get();
  if(!snap.exists()){
    await db.ref("users/"+mobile).set({pin:pin, coins:1000, level:1});
    userPhone = mobile; userCoins = 1000; userLevel = 1;
  } else {
    const user = snap.val();
    if(user.pin!==pin){ document.getElementById("loginMsg").innerText="PIN ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü"; return; }
    userPhone = mobile;
    userCoins = user.coins || 0;
    userLevel = user.level || 1;
  }
  loginBox.style.display="none";
  gameBox.style.display="block";
  updateCoinsView();
  updateHistoryView();
});

// ================= Coins View =================
function updateCoinsView(){ coinsView.innerText = "Coins: "+Math.floor(userCoins); }

// ================= History View =================
function updateHistoryView(){
    historyDiv.innerHTML = history.slice(-10).reverse().map(h=>`‚Ä¢ ${h}`).join("<br>");
}

// ================= Coins Input Buttons =================
document.getElementById("decCoin").addEventListener("click",()=>{ betInput.value=Math.max(1, Number(betInput.value)-1); });
document.getElementById("incCoin").addEventListener("click",()=>{ betInput.value=Math.min(20000, Number(betInput.value)+1); });

// ================= Spin Game =================
spinBtn.addEventListener("click", async ()=>{
  let bet = Number(betInput.value);
  if(bet>userCoins){ document.getElementById("spinMsg").innerText="‚ùå Coins ‡¶ï‡¶Æ ‡¶Ü‡¶õ‡ßá"; return; }

  spinBtn.disabled = true;
  spinSound.currentTime=0; spinSound.play();

  let angle = Math.floor(Math.random()*360 + 1440 + Math.random()*3600); 
  wheel.style.transition = "transform 1s cubic-bezier(0.25,1,0.5,1)";
  wheel.style.transform = `rotate(${angle}deg)`;

  const multipliers = [1,2,3,4,5];
  const step = Math.min(userLevel-1, multipliers.length-1);

  let baseWinChance = 0.2; 
  if(bet>100) baseWinChance = 0.1;
  else if(bet>500) baseWinChance = 0.05;

  const win = Math.random()<baseWinChance;
  let prize = 0;
  const adminCut = Math.floor(bet*0.3);
  const playAmount = bet - adminCut;

  if(win){
    prize = playAmount * multipliers[step];
    userCoins += prize;
    userLevel = Math.min(userLevel+1, multipliers.length);
    history.push(`üéâ ‡¶ú‡ßü! ${Math.floor(prize)} Coins (x${multipliers[step]})`);
  } else {
    userCoins -= bet;
    history.push(`üíî ‡¶π‡¶æ‡¶∞‡¶æ! ${bet} Coins ‡¶π‡¶æ‡¶∞‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá`);
  }
  updateCoinsView();
  updateHistoryView();

  await db.ref("users/"+userPhone).update({
      coins:userCoins,
      level:userLevel,
      adminCut:adminCut
  });

  setTimeout(()=>{ spinBtn.disabled=false; }, 1000);
});
</script>
</body>
</html>